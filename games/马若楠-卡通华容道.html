<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¡é€šæ•°å­—åå®¹é“</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366F1',
            secondary: '#EC4899',
            accent: '#F59E0B',
            light: '#F3F4F6',
            dark: '#1F2937',
          },
          fontFamily: {
            comic: ['"Comic Sans MS"', '"Bubblegum Sans"', 'cursive'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .puzzle-shadow {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
      }
      .animate-slide {
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .card-hover {
        transition: all 0.2s ease;
      }
      .card-hover:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-purple-100 to-pink-100 min-h-screen font-comic flex flex-col items-center justify-center p-4">
<!-- è¿”å›ä¸»é¡µæŒ‰é’® -->
<div id="homeNavigation" style="position: fixed; top: 20px; left: 20px; z-index: 9999;">
    <a href="../index.html" 
       style="display: inline-flex; align-items: center; gap: 8px; 
              background: linear-gradient(135deg, #FF6B6B, #4ECDC4); 
              color: white; padding: 12px 20px; border-radius: 25px; 
              text-decoration: none; font-family: 'Microsoft YaHei', sans-serif; 
              font-weight: bold; font-size: 14px; 
              box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
              transition: all 0.3s ease;
              backdrop-filter: blur(10px);"
       onmouseover="this.style.transform='translateY(-2px) scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)';"
       onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)';">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        è¿”å›æ˜Ÿçƒå·¥åŠ
    </a>
</div>

  <!-- æ¸¸æˆæ ‡é¢˜ -->
  <div class="text-center mb-6">
    <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-primary text-shadow mb-2">
      <i class="fa fa-puzzle-piece text-accent mr-2"></i>å¡é€šæ•°å­—åå®¹é“
    </h1>
    <p class="text-gray-600 text-lg">å°†æ•°å­—æŒ‰é¡ºåºæ’åˆ—ï¼ŒæŒ‘æˆ˜ä½ çš„è„‘åŠ›ï¼</p>
  </div>
  
  <!-- æ¸¸æˆä¿¡æ¯é¢æ¿ -->
  <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow-lg mb-6 w-full max-w-md">
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-primary/10 rounded-lg p-3 flex items-center justify-center">
        <i class="fa fa-clock-o text-primary text-xl mr-2"></i>
        <span class="text-dark font-bold text-xl" id="timer">00:00</span>
      </div>
      <div class="bg-secondary/10 rounded-lg p-3 flex items-center justify-center">
        <i class="fa fa-exchange text-secondary text-xl mr-2"></i>
        <span class="text-dark font-bold text-xl" id="moves">0</span>
        <span class="text-gray-500 ml-1">æ­¥</span>
      </div>
    </div>
    
    <!-- æ§åˆ¶æŒ‰é’® -->
    <div class="flex justify-center mt-4 gap-3">
      <button id="restart" class="bg-accent hover:bg-accent/90 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl flex items-center">
        <i class="fa fa-refresh mr-2"></i>é‡æ–°å¼€å§‹
      </button>
      <select id="difficulty" class="bg-white border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
        <option value="3">3x3 ç®€å•</option>
        <option value="4" selected>4x4 ä¸­ç­‰</option>
        <option value="5">5x5 å›°éš¾</option>
      </select>
    </div>
  </div>
  
  <!-- æ¸¸æˆæ£‹ç›˜ -->
  <div id="game-container" class="relative w-full max-w-md aspect-square bg-white/60 backdrop-blur-sm rounded-2xl p-4 puzzle-shadow">
    <div id="puzzle-board" class="grid w-full h-full gap-3"></div>
    
    <!-- å®Œæˆæç¤ºå±‚ -->
    <div id="success-modal" class="absolute inset-0 bg-primary/90 rounded-2xl flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500">
      <div class="text-center p-6">
        <div class="text-[clamp(3rem,8vw,5rem)] text-yellow-300 mb-4">ğŸ‰</div>
        <h2 class="text-white text-[clamp(1.5rem,4vw,2.5rem)] font-bold mb-2">æ­å–œä½ !</h2>
        <p class="text-white/90 text-lg mb-4">ä½ æˆåŠŸå®Œæˆäº†åå®¹é“æŒ‘æˆ˜!</p>
        <div class="bg-white/20 rounded-lg p-3 mb-6">
          <p class="text-white font-bold">ç”¨æ—¶: <span id="final-time">00:00</span></p>
          <p class="text-white font-bold">æ­¥æ•°: <span id="final-moves">0</span></p>
        </div>
        <button id="play-again" class="bg-white text-primary font-bold py-2 px-6 rounded-full transition-all duration-300 hover:bg-yellow-300 hover:text-primary transform hover:scale-105">
          å†æ¥ä¸€å±€
        </button>
      </div>
    </div>
  </div>
  
  <!-- é¡µè„šä¿¡æ¯ -->
  <div class="mt-8 text-center text-gray-500 text-sm">
    <p>ä½¿ç”¨é”®ç›˜æ–¹å‘é”®æˆ–ç‚¹å‡»æ•°å­—ç§»åŠ¨æ–¹å—</p>
    <p class="mt-2">Â© 2025 å¡é€šåå®¹é“æ¸¸æˆ</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // æ¸¸æˆé…ç½®
      let size = 4; // é»˜è®¤4x4
      let puzzle = [];
      let emptyPos = { row: size - 1, col: size - 1 };
      let moves = 0;
      let timer = 0;
      let timerInterval;
      let isGameStarted = false;
      let isGameCompleted = false;
      
      // å¡é€šè§’è‰²é¢œè‰²æ˜ å°„
      const colors = [
        'bg-red-400', 'bg-blue-400', 'bg-green-400', 'bg-yellow-400',
        'bg-purple-400', 'bg-pink-400', 'bg-indigo-400', 'bg-teal-400',
        'bg-orange-400', 'bg-amber-400', 'bg-emerald-400', 'bg-cyan-400',
        'bg-sky-400', 'bg-fuchsia-400', 'bg-rose-400', 'bg-lime-400',
        'bg-olive-400', 'bg-maroon-400', 'bg-navy-400', 'bg-charcoal-400',
        'bg-silver-400', 'bg-gold-400', 'bg-bronze-400', 'bg-copper-400'
      ];
      
      // å¡é€šå›¾æ ‡æ˜ å°„
      const icons = [
        'fa-smile-o', 'fa-heart-o', 'fa-star-o', 'fa-bell-o',
        'fa-coffee', 'fa-moon-o', 'fa-sun-o', 'fa-leaf',
        'fa-diamond', 'fa-paper-plane-o', 'fa-rocket', 'fa-tree',
        'fa-car', 'fa-plane', 'fa-ship', 'fa-bicycle',
        'fa-gamepad', 'fa-music', 'fa-paint-brush', 'fa-book',
        'fa-graduation-cap', 'fa-camera', 'fa-video-camera', 'fa-paw'
      ];
      
      // DOM å…ƒç´ 
      const puzzleBoard = document.getElementById('puzzle-board');
      const movesCounter = document.getElementById('moves');
      const timerDisplay = document.getElementById('timer');
      const restartButton = document.getElementById('restart');
      const difficultySelect = document.getElementById('difficulty');
      const successModal = document.getElementById('success-modal');
      const finalTimeDisplay = document.getElementById('final-time');
      const finalMovesDisplay = document.getElementById('final-moves');
      const playAgainButton = document.getElementById('play-again');
      
      // åˆå§‹åŒ–æ¸¸æˆ
      function initGame() {
        // é‡ç½®æ¸¸æˆçŠ¶æ€
        moves = 0;
        movesCounter.textContent = moves;
        stopTimer();
        timer = 0;
        timerDisplay.textContent = '00:00';
        isGameStarted = false;
        isGameCompleted = false;
        successModal.classList.add('opacity-0', 'pointer-events-none');
        
        // è·å–éš¾åº¦è®¾ç½®
        size = parseInt(difficultySelect.value);
        emptyPos = { row: size - 1, col: size - 1 };
        
        // æ¸…ç©ºæ£‹ç›˜
        puzzleBoard.innerHTML = '';
        puzzleBoard.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
        
        // ç”Ÿæˆæ‹¼å›¾æ•°æ®
        generatePuzzle();
        
        // æ¸²æŸ“æ£‹ç›˜
        renderBoard();
        
        // æ·»åŠ é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', handleKeyPress);
      }
      
      // ç”Ÿæˆéšæœºå¯è§£çš„æ‹¼å›¾
      function generatePuzzle() {
        // åˆ›å»ºæœ‰åºæ•°ç»„
        const numbers = Array(size * size - 1).fill().map((_, i) => i + 1);
        
        // æ´—ç‰Œç®—æ³•
        for (let i = numbers.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
        }
        
        // è½¬æ¢ä¸ºäºŒç»´æ•°ç»„
        puzzle = [];
        for (let i = 0; i < size; i++) {
          const row = [];
          for (let j = 0; j < size; j++) {
            const index = i * size + j;
            if (index < numbers.length) {
              row.push(numbers[index]);
            } else {
              row.push(null); // ç©ºç™½æ–¹å—
            }
          }
          puzzle.push(row);
        }
        
        // æ£€æŸ¥æ˜¯å¦å¯è§£ï¼Œå¦‚æœä¸å¯è§£åˆ™é‡æ–°ç”Ÿæˆ
        if (!isSolvable(puzzle, size)) {
          generatePuzzle();
        }
      }
      
      // æ£€æŸ¥æ‹¼å›¾æ˜¯å¦å¯è§£
      function isSolvable(puzzle, size) {
        // å°†äºŒç»´æ•°ç»„å±•å¹³ä¸ºä¸€ç»´æ•°ç»„
        const flatPuzzle = puzzle.flat();
        
        // è®¡ç®—é€†åºæ•°
        let inversions = 0;
        const puzzleWithoutEmpty = flatPuzzle.filter(num => num !== null);
        
        for (let i = 0; i < puzzleWithoutEmpty.length; i++) {
          for (let j = i + 1; j < puzzleWithoutEmpty.length; j++) {
            if (puzzleWithoutEmpty[i] > puzzleWithoutEmpty[j]) {
              inversions++;
            }
          }
        }
        
        // å¯¹äºå¥‡æ•°å¤§å°çš„æ£‹ç›˜ï¼Œé€†åºæ•°å¿…é¡»ä¸ºå¶æ•°
        if (size % 2 === 1) {
          return inversions % 2 === 0;
        } 
        // å¯¹äºå¶æ•°å¤§å°çš„æ£‹ç›˜ï¼Œå–å†³äºç©ºç™½æ–¹å—æ‰€åœ¨çš„è¡Œ
        else {
          // æ‰¾åˆ°ç©ºç™½æ–¹å—çš„è¡Œ
          const emptyRow = flatPuzzle.indexOf(null) / size;
          
          // å¦‚æœç©ºç™½æ–¹å—åœ¨å¶æ•°è¡Œ(0, 2, 4...)ï¼Œåˆ™é€†åºæ•°å¿…é¡»ä¸ºå¥‡æ•°
          if (Math.floor(emptyRow) % 2 === 0) {
            return inversions % 2 === 1;
          } 
          // å¦‚æœç©ºç™½æ–¹å—åœ¨å¥‡æ•°è¡Œ(1, 3, 5...)ï¼Œåˆ™é€†åºæ•°å¿…é¡»ä¸ºå¶æ•°
          else {
            return inversions % 2 === 0;
          }
        }
      }
      
      // æ¸²æŸ“æ£‹ç›˜
      function renderBoard() {
        puzzleBoard.innerHTML = '';
        
        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            const tile = document.createElement('div');
            const value = puzzle[i][j];
            
            if (value !== null) {
              // è®¡ç®—é¢œè‰²å’Œå›¾æ ‡ç´¢å¼•
              const colorIndex = (value - 1) % colors.length;
              const iconIndex = (value - 1) % icons.length;
              
              // è®¾ç½®æ–¹å—æ ·å¼
              tile.className = `${colors[colorIndex]} rounded-xl shadow-lg flex items-center justify-center card-hover animate-slide cursor-pointer`;
              tile.innerHTML = `
                <div class="text-center">
                  <i class="fa ${icons[iconIndex]} text-white text-3xl mb-1"></i>
                  <div class="text-white font-bold text-2xl">${value}</div>
                </div>
              `;
              
              // æ·»åŠ ç‚¹å‡»äº‹ä»¶
              tile.addEventListener('click', () => moveTile(i, j));
              
              // è®¾ç½®æ•°æ®å±æ€§
              tile.dataset.row = i;
              tile.dataset.col = j;
            } else {
              // ç©ºç™½æ–¹å—
              tile.className = 'bg-transparent rounded-xl';
            }
            
            puzzleBoard.appendChild(tile);
          }
        }
      }
      
      // ç§»åŠ¨æ–¹å—
      function moveTile(row, col) {
        // å¦‚æœæ¸¸æˆå·²å®Œæˆåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
        if (isGameCompleted) return;
        
        // å¦‚æœç¬¬ä¸€æ¬¡ç§»åŠ¨ï¼Œå¼€å§‹è®¡æ—¶
        if (!isGameStarted) {
          startTimer();
          isGameStarted = true;
        }
        
        // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç§»åŠ¨
        if (
          (row === emptyPos.row && Math.abs(col - emptyPos.col) === 1) ||
          (col === emptyPos.col && Math.abs(row - emptyPos.row) === 1)
        ) {
          // äº¤æ¢æ–¹å—å’Œç©ºç™½ä½ç½®
          puzzle[emptyPos.row][emptyPos.col] = puzzle[row][col];
          puzzle[row][col] = null;
          
          // æ›´æ–°ç©ºç™½ä½ç½®
          emptyPos.row = row;
          emptyPos.col = col;
          
          // æ›´æ–°ç§»åŠ¨æ¬¡æ•°
          moves++;
          movesCounter.textContent = moves;
          
          // é‡æ–°æ¸²æŸ“æ£‹ç›˜
          renderBoard();
          
          // æ£€æŸ¥æ˜¯å¦å®Œæˆ
          if (isCompleted()) {
            completeGame();
          }
        }
      }
      
      // é”®ç›˜æ§åˆ¶
      function handleKeyPress(e) {
        if (isGameCompleted) return;
        
        const { row, col } = emptyPos;
        
        switch (e.key) {
          case 'ArrowUp':
            if (row < size - 1) moveTile(row + 1, col);
            break;
          case 'ArrowDown':
            if (row > 0) moveTile(row - 1, col);
            break;
          case 'ArrowLeft':
            if (col < size - 1) moveTile(row, col + 1);
            break;
          case 'ArrowRight':
            if (col > 0) moveTile(row, col - 1);
            break;
        }
      }
      
      // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
      function isCompleted() {
        let count = 1;
        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            if (i === size - 1 && j === size - 1) {
              // æœ€åä¸€ä¸ªä½ç½®åº”è¯¥æ˜¯ç©ºçš„
              if (puzzle[i][j] !== null) return false;
            } else {
              // å…¶ä»–ä½ç½®åº”è¯¥æŒ‰é¡ºåºæ’åˆ—
              if (puzzle[i][j] !== count) return false;
              count++;
            }
          }
        }
        return true;
      }
      
      // æ¸¸æˆå®Œæˆå¤„ç†
      function completeGame() {
        stopTimer();
        isGameCompleted = true;
        
        // æ›´æ–°å®Œæˆä¿¡æ¯
        finalTimeDisplay.textContent = timerDisplay.textContent;
        finalMovesDisplay.textContent = moves;
        
        // æ˜¾ç¤ºæˆåŠŸæ¨¡æ€æ¡†
        setTimeout(() => {
          successModal.classList.remove('opacity-0', 'pointer-events-none');
        }, 500);
        
        // ç§»é™¤é”®ç›˜æ§åˆ¶
        document.removeEventListener('keydown', handleKeyPress);
      }
      
      // å¼€å§‹è®¡æ—¶å™¨
      function startTimer() {
        timerInterval = setInterval(() => {
          timer++;
          const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
          const seconds = (timer % 60).toString().padStart(2, '0');
          timerDisplay.textContent = `${minutes}:${seconds}`;
        }, 1000);
      }
      
      // åœæ­¢è®¡æ—¶å™¨
      function stopTimer() {
        clearInterval(timerInterval);
      }
      
      // äº‹ä»¶ç›‘å¬å™¨
      restartButton.addEventListener('click', initGame);
      playAgainButton.addEventListener('click', initGame);
      difficultySelect.addEventListener('change', initGame);
      
      // åˆå§‹åŒ–æ¸¸æˆ
      initGame();
    });
  </script>

<!-- Author Signature Widget V2 -->
<script id="author-signature-widget-v2">
  (function() {
    function showSignature() {
      var authorNameStr = '*è‹¥æ¥ ';

      if (document.getElementById('author-signature-container-v2')) {
        return;
      }

      var container = document.createElement('div');
      container.id = 'author-signature-container-v2';
      container.style.position = 'fixed';
      container.style.top = '50%';
      container.style.left = '50%';
      container.style.transform = 'translate(-50%, -50%) scale(0.7)';
      container.style.padding = '30px 50px';
      container.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
      container.style.color = 'white';
      container.style.borderRadius = '20px';
      container.style.zIndex = '2147483647';
      container.style.fontFamily = '"PingFang SC", "Helvetica Neue", "Microsoft YaHei", sans-serif';
      container.style.fontSize = '10vw';
      container.style.fontWeight = 'bold';
      container.style.textAlign = 'center';
      container.style.boxShadow = '0 10px 30px rgba(0,0,0,0.5)';
      container.style.opacity = '0';
      container.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
      container.style.whiteSpace = 'nowrap';
      container.style.cursor = 'pointer';

      var textElement = document.createElement('span');
      textElement.textContent = 'ä½œè€…: ' + authorNameStr;

      var hideWidget = function() {
        container.style.transform = 'translate(-50%, -50%) scale(0.7)';
        container.style.opacity = '0';
        setTimeout(function() {
          if (container.parentNode) {
            container.parentNode.removeChild(container);
          }
        }, 500);
      };

      container.onclick = hideWidget;

      container.appendChild(textElement);
      document.body.appendChild(container);

      setTimeout(function() {
        container.style.opacity = '1';
        container.style.transform = 'translate(-50%, -50%) scale(1)';
      }, 50);

      setTimeout(hideWidget, 5000);
    }

    if (document.body) {
        showSignature();
    } else {
        document.addEventListener('DOMContentLoaded', showSignature);
    }
  })();
</script>
</body>
</html>
    